# <!-- 由 BMAD™ 核心驱动 -->
template:
  id: level-design-doc-template-v2
  name: 关卡设计文档
  version: 2.0
  output:
    format: markdown
    filename: "docs/{{game_name}}-level-design-document.md"
    title: "{{game_title}} 关卡设计文档"

workflow:
  mode: interactive

sections:
  - id: initial-setup
    instruction: |
      此模板创建了全面的关卡设计文档，用于指导内容创作和技术实施。本文档应提供足够的细节，以便开发者创建关卡加载系统，设计师创建具体关卡。

      如果可用，请审查：游戏设计文档 (GDD)、游戏架构文档。本文档应与这些文档中定义的游戏机制和技术系统保持一致。

  - id: introduction
    title: 引言
    instruction: 确立此游戏关卡设计的目的和范围
    content: |
      本文档定义了 {{game_title}} 的关卡设计框架，为创建引人入胜、平衡的关卡提供了指导，这些关卡支持游戏设计文档中定义的核心游戏机制。

      该框架确保了所有关卡的一致性，同时在既定的技术和设计约束内为创意关卡设计提供了灵活性。
    sections:
      - id: change-log
        title: 变更日志
        instruction: 跟踪文档版本和变更
        type: table
        template: |
          | 日期 | 版本 | 描述 | 作者 |
          | :--- | :------ | :---------- | :----- |

  - id: level-design-philosophy
    title: 关卡设计理念
    instruction: 根据游戏的核心支柱和机制，建立关卡设计的总体方法。在呈现此部分后应用 `tasks#advanced-elicitation`。
    sections:
      - id: design-principles
        title: 设计原则
        instruction: 定义3-5个指导所有关卡设计决策的核心原则
        type: numbered-list
        template: |
          **{{principle_name}}** - {{description}}
      - id: player-experience-goals
        title: 玩家体验目标
        instruction: 定义玩家在每个关卡类别中应该感受到什么和学到什么
        template: |
          **教程关卡：** {{experience_description}}
          **标准关卡：** {{experience_description}}
          **挑战关卡：** {{experience_description}}
          **Boss 关卡：** {{experience_description}}
      - id: level-flow-framework
        title: 关卡流程框架
        instruction: 定义关卡进程的标准结构
        template: |
          **介绍阶段：** {{duration}} - {{purpose}}
          **发展阶段：** {{duration}} - {{purpose}}
          **高潮阶段：** {{duration}} - {{purpose}}
          **解决阶段：** {{duration}} - {{purpose}}

  - id: level-categories
    title: 关卡类别
    instruction: 根据 GDD 要求定义不同类型的关卡。每个类别都应足够具体以便实施。
    repeatable: true
    sections:
      - id: level-category
        title: "{{category_name}} 关卡"
        template: |
          **目的：** {{gameplay_purpose}}

          **目标时长：** {{min_time}} - {{max_time}} 分钟

          **难度范围：** {{difficulty_scale}}

          **主要特色机制：**

          - {{mechanic_1}} - {{usage_description}}
          - {{mechanic_2}} - {{usage_description}}

          **玩家目标：**

          - 主要：{{primary_objective}}
          - 次要：{{secondary_objective}}
          - 隐藏：{{secret_objective}}

          **成功标准：**

          - {{completion_requirement_1}}
          - {{completion_requirement_2}}

          **技术要求：**

          - 最大实体数：{{entity_limit}}
          - 性能目标：{{fps_target}} FPS
          - 内存预算：{{memory_limit}}MB
          - 资产要求：{{asset_needs}}

  - id: level-progression-system
    title: 关卡进程系统
    instruction: 定义玩家如何通过关卡以及难度如何扩展
    sections:
      - id: world-structure
        title: 世界结构
        instruction: 根据 GDD 要求，定义总体关卡组织
        template: |
          **组织类型：** {{linear|hub_world|open_world}}

          **总关卡数：** {{number}}

          **世界分解：**

          - 世界 1：{{level_count}} 关卡 - {{theme}} - {{difficulty_range}}
          - 世界 2：{{level_count}} 关卡 - {{theme}} - {{difficulty_range}}
          - 世界 3：{{level_count}} 关卡 - {{theme}} - {{difficulty_range}}
      - id: difficulty-progression
        title: 难度进程
        instruction: 定义挑战如何在整个游戏中增加
        sections:
          - id: progression-curve
            title: 进程曲线
            type: code
            language: text
            template: |
              难度
                  ^     ___/```
                  |    /
                  |   /     ___/```
                  |  /     /
                  | /     /
                  |/     /
                  +-----------> 关卡编号
                 教程  早期  中期  后期
          - id: scaling-parameters
            title: 扩展参数
            type: bullet-list
            template: |
              - 敌人数量：{{start_count}} → {{end_count}}
              - 敌人难度：{{start_diff}} → {{end_diff}}
              - 关卡复杂度：{{start_complex}} → {{end_complex}}
              - 时间压力：{{start_time}} → {{end_time}}
      - id: unlock-requirements
        title: 解锁要求
        instruction: 定义玩家如何访问新关卡
        template: |
          **进程门槛：**

          - 线性进程：完成前一个关卡
          - 星星要求：{{star_count}} 颗星星解锁
          - 技能门槛：展示 {{skill_requirement}}
          - 可选内容：{{unlock_condition}}

  - id: level-design-components
    title: 关卡设计组件
    instruction: 定义用于创建关卡的构建块
    sections:
      - id: environmental-elements
        title: 环境元素
        instruction: 定义可在关卡中使用的所有环境组件
        template: |
          **地形类型：**

          - {{terrain_1}}: {{properties_and_usage}}
          - {{terrain_2}}: {{properties_and_usage}}

          **互动对象：**

          - {{object_1}}: {{behavior_and_purpose}}
          - {{object_2}}: {{behavior_and_purpose}}

          **危险和障碍：**

          - {{hazard_1}}: {{damage_and_behavior}}
          - {{hazard_2}}: {{damage_and_behavior}}
      - id: collectibles-rewards
        title: 收藏品和奖励
        instruction: 定义所有收藏品及其放置规则
        template: |
          **收藏品类型：**

          - {{collectible_1}}: {{value_and_purpose}}
          - {{collectible_2}}: {{value_and_purpose}}

          **放置指南：**

          - 强制收藏品：{{placement_rules}}
          - 可选收藏品：{{placement_rules}}
          - 秘密收藏品：{{placement_rules}}

          **奖励分配：**

          - 容易找到：{{percentage}}%
          - 中等挑战：{{percentage}}%
          - 需要高技能：{{percentage}}%
      - id: enemy-placement-framework
        title: 敌人放置框架
        instruction: 定义应如何在关卡中放置和平衡敌人
        template: |
          **敌人类别：**

          - {{enemy_type_1}}: {{behavior_and_usage}}
          - {{enemy_type_2}}: {{behavior_and_usage}}

          **放置原则：**

          - 介绍性遭遇：{{guideline}}
          - 标准遭遇：{{guideline}}
          - 挑战性遭遇：{{guideline}}

          **难度扩展：**

          - 敌人数量进程：{{scaling_rule}}
          - 敌人类型介绍：{{pacing_rule}}
          - 遭遇复杂度：{{complexity_rule}}

  - id: level-creation-guidelines
    title: 关卡创建指南
    instruction: 提供创建单个关卡的具体指南
    sections:
      - id: level-layout-principles
        title: 关卡布局原则
        template: |
          **空间设计：**

          - 网格大小：{{grid_dimensions}}
          - 最小路径宽度：{{width_units}}
          - 最大垂直距离：{{height_units}}
          - 安全区放置：{{safety_guidelines}}

          **导航设计：**

          - 清晰的路径指示：{{visual_cues}}
          - 地标放置：{{landmark_rules}}
          - 避免死胡同：{{dead_end_policy}}
          - 多路径选项：{{branching_rules}}
      - id: pacing-and-flow
        title: 节奏和流程
        instruction: 定义如何在关卡内控制游戏玩法的节奏
        template: |
          **动作序列：**

          - 高强度持续时间：{{max_duration}}
          - 休息时间要求：{{min_rest_time}}
          - 强度变化：{{pacing_pattern}}

          **学习序列：**

          - 新机制介绍：{{teaching_method}}
          - 练习机会：{{practice_duration}}
          - 技能应用：{{application_context}}
      - id: challenge-design
        title: 挑战设计
        instruction: 定义如何为每种关卡类型创建适当的挑战
        template: |
          **挑战类型：**

          - 执行挑战：{{skill_requirements}}
          - 解谜挑战：{{complexity_guidelines}}
          - 时间挑战：{{time_pressure_rules}}
          - 资源挑战：{{resource_management}}

          **难度校准：**

          - 技能检查频率：{{frequency_guidelines}}
          - 失败恢复：{{retry_mechanics}}
          - 提示系统集成：{{help_system}}

  - id: technical-implementation
    title: 技术实施
    instruction: 定义关卡实施的技术要求
    sections:
      - id: level-data-structure
        title: 关卡数据结构
        instruction: 定义关卡数据应如何结构化以供实施
        template: |
          **关卡文件格式：**

          - 数据格式：{{json|yaml|custom}}
          - 文件命名：`level_{{world}}_{{number}}.{{extension}}`
          - 数据组织：{{structure_description}}
        sections:
          - id: required-data-fields
            title: 必需的数据字段
            type: code
            language: json
            template: |
              {
                "levelId": "{{unique_identifier}}",
                "worldId": "{{world_identifier}}",
                "difficulty": {{difficulty_value}},
                "targetTime": {{completion_time_seconds}},
                "objectives": {
                  "primary": "{{primary_objective}}",
                  "secondary": ["{{secondary_objectives}}"],
                  "hidden": ["{{secret_objectives}}"]
                },
                "layout": {
                  "width": {{grid_width}},
                  "height": {{grid_height}},
                  "tilemap": "{{tilemap_reference}}"
                },
                "entities": [
                  {
                    "type": "{{entity_type}}",
                    "position": {"x": {{x}}, "y": {{y}}},
                    "properties": {{entity_properties}}
                  }
                ]
              }
      - id: asset-integration
        title: 资产集成
        instruction: 定义如何组织和加载关卡资产
        template: |
          **瓦片地图要求：**

          - 瓦片大小：{{tile_dimensions}}px
          - 瓦片集组织：{{tileset_structure}}
          - 图层组织：{{layer_system}}
          - 碰撞数据：{{collision_format}}

          **音频集成：**

          - 背景音乐：{{music_requirements}}
          - 环境声音：{{ambient_system}}
          - 动态音频：{{dynamic_audio_rules}}
      - id: performance-optimization
        title: 性能优化
        instruction: 定义关卡系统的性能要求
        template: |
          **实体限制：**

          - 最大活动实体数：{{entity_limit}}
          - 最大粒子数：{{particle_limit}}
          - 最大音频源数：{{audio_limit}}

          **内存管理：**

          - 纹理内存预算：{{texture_memory}}MB
          - 音频内存预算：{{audio_memory}}MB
          - 关卡加载时间：<{{load_time}}s

          **剔除和 LOD：**

          - 屏幕外剔除：{{culling_distance}}
          - 细节层次规则：{{lod_system}}
          - 资产流式传输：{{streaming_requirements}}

  - id: level-testing-framework
    title: 关卡测试框架
    instruction: 定义应如何测试和验证关卡
    sections:
      - id: automated-testing
        title: 自动化测试
        template: |
          **性能测试：**

          - 帧率验证：保持 {{fps_target}} FPS
          - 内存使用监控：保持在 {{memory_limit}}MB 以下
          - 加载时间验证：在 <{{load_time}}s 内完成

          **游戏性测试：**

          - 完成路径验证：所有目标均可实现
          - 收藏品可及性：所有物品均可到达
          - 软锁预防：无无法获胜的状态
      - id: manual-testing-protocol
        title: 手动测试协议
        sections:
          - id: playtesting-checklist
            title: 游戏测试清单
            type: checklist
            items:
              - "在目标时间范围内完成关卡"
              - "所有机制功能正常"
              - "难度感觉适合关卡类别"
              - "玩家引导清晰有效"
              - "无漏洞或序列中断（除非有意为之）"
          - id: player-experience-testing
            title: 玩家体验测试
            type: checklist
            items:
              - "教程关卡教学有效"
              - "挑战感觉公平且有回报"
              - "流程和节奏保持参与感"
              - "音频和视觉反馈支持游戏性"
      - id: balance-validation
        title: 平衡验证
        template: |
          **指标收集：**

          - 完成率：目标 {{completion_percentage}}%
          - 平均完成时间：{{target_time}} ± {{variance}}
          - 每关死亡次数：<{{max_deaths}}
          - 收藏品发现率：{{discovery_percentage}}%

          **迭代指南：**

          - 调整标准：{{criteria_for_changes}}
          - 测试样本量：{{minimum_testers}}
          - 验证期：{{testing_duration}}

  - id: content-creation-pipeline
    title: 内容创作管道
    instruction: 定义创建新关卡的工作流程
    sections:
      - id: design-phase
        title: 设计阶段
        template: |
          **概念开发：**

          1. 定义关卡目的和目标
          2. 创建粗略的布局草图
          3. 确定关键机制和挑战
          4. 估算难度和时长

          **文档要求：**

          - 关卡设计简介
          - 布局图
          - 机制集成说明
          - 资产要求列表
      - id: implementation-phase
        title: 实施阶段
        template: |
          **技术实施：**

          1. 创建关卡数据文件
          2. 构建瓦片地图和布局
          3. 放置实体和对象
          4. 配置关卡逻辑和触发器
          5. 集成音频和视觉效果

          **质量保证：**

          1. 执行自动化测试
          2. 内部游戏测试
          3. 性能验证
          4. 错误修复和润色
      - id: integration-phase
        title: 集成阶段
        template: |
          **游戏集成：**

          1. 关卡进程集成
          2. 保存系统兼容性
          3. 分析集成
          4. 成就系统集成

          **最终验证：**

          1. 完整游戏背景测试
          2. 性能回归测试
          3. 平台兼容性验证
          4. 最终批准和发布

  - id: success-metrics
    title: 成功指标
    instruction: 定义如何衡量关卡设计的成功
    sections:
      - id: player-engagement
        title: 玩家参与度
        type: bullet-list
        template: |
          - 关卡完成率：{{target_rate}}%
          - 重玩率：{{replay_target}}%
          - 每关花费时间：{{engagement_time}}
          - 玩家满意度分数：{{satisfaction_target}}/10
      - id: technical-performance
        title: 技术性能
        type: bullet-list
        template: |
          - 帧率一致性：{{fps_consistency}}%
          - 加载时间合规性：{{load_compliance}}%
          - 内存使用效率：{{memory_efficiency}}%
          - 崩溃率：<{{crash_threshold}}%
      - id: design-quality
        title: 设计质量
        type: bullet-list
        template: |
          - 难度曲线遵守情况：{{curve_accuracy}}
          - 机制集成有效性：{{integration_score}}
          - 玩家引导清晰度：{{guidance_score}}
          - 内容无障碍性：{{accessibility_rate}}%
